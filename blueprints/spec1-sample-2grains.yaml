spec_version: 2
description: Spec1 sample blueprint created with spec2 using Terraform
# blueprint inputs can be provided by the user, API or CI plugin when creating an environment from this blueprint.
inputs:
  host_name:
    type: execution-host
    allowed_values:
      - eks
    default: eks
outputs:
  URL:
    value: '{{ .grains.application.outputs.load_balancer_url }}'
    kind: link

grains:
  infra:
    kind: terraform
    depends-on: application

    spec:
      source:
        path: github.com/qualitorque/tfsamples.git//terraform-modules/sandbox-infra
      host:
        name: '{{ .inputs.host_name }}'
        service-account: torque-sandbox-creator
      inputs:
      outputs:
      - default_sandbox_security_group
       
    tf-version: 1.2.5
  application:
    kind: terraform
    depends-on: infra
    spec:
      source:
        path: github.com/qualitorque/tfsamples.git//terraform-modules/sandbox-application
      host:
        name: '{{ .inputs.host_name }}'
        service-account: torque-sandbox-creator
      inputs:
        - default_sandbox_security_group: '{{.grains.infra.outputs.default_sandbox_security_group}}'
      outputs:
        - load_balancer_url
    tf-version: 1.2.5